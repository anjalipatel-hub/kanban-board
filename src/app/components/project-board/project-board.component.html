<!-- ðŸ” Filters & Search Bar -->
<div
  class="filters-bar flex flex-wrap items-center gap-6 p-5 mb-8 mt-40
         bg-white dark:bg-grey-dark rounded-lg shadow-md"
>
  <!-- Search -->
  <input
    type="text"
    [(ngModel)]="searchTerm"
    placeholder="ðŸ” Search tasks..."
    class="border border-gray-300 rounded-lg px-4 py-2 min-w-[40rem]
           focus:ring-2 focus:ring-purple-500 focus:outline-none"
  />

  <!-- Status Filter -->
  <select
    [(ngModel)]="filterStatus"
    class="border border-gray-300 rounded-lg px-4 py-2 min-w-[20rem]
           focus:ring-2 focus:ring-purple-500 focus:outline-none"
  >
    <option value="">All Status</option>
    <option value="todo">ToDo</option>
    <option value="in-progress">In Progress</option>
    <option value="done">Done</option>
  </select>

  <!-- Priority Filter -->
  <select
    [(ngModel)]="filterPriority"
    class="border border-gray-300 rounded-lg px-4 py-2 min-w-[20rem]
           focus:ring-2 focus:ring-purple-500 focus:outline-none"
  >
    <option value="">All Priority</option>
    <option value="Low">Low</option>
    <option value="Medium">Medium</option>
    <option value="High">High</option>
  </select>

  <!-- Date Range -->
  <div class="flex items-center gap-3">
    <input
      type="date"
      [(ngModel)]="filterStartDate"
      class="border border-gray-300 rounded-lg px-3 py-2
             focus:ring-2 focus:ring-purple-500 focus:outline-none"
    />
    <span class="text-gray-500">to</span>
    <input
      type="date"
      [(ngModel)]="filterEndDate"
      class="border border-gray-300 rounded-lg px-3 py-2
             focus:ring-2 focus:ring-purple-500 focus:outline-none"
    />
  </div>

  <!-- Reset Button (Right Side) -->
  <div class="ml-auto">
    <button
      (click)="resetFilters()"
      class="px-5 py-2 rounded-lg bg-purple-600 text-white font-medium
             hover:bg-purple-700 transition"
    >
      Reset Filters
    </button>
  </div>
</div>

<!-- ðŸ—‚ï¸ Kanban Board -->
<div
  class="board-container board mt-6 h-screen overflow-auto whitespace-nowrap 
         bg-grey-light px-4 py-6 dark:bg-grey-vdark sm:px-6"
>
  <ng-container *ngIf="activeBoard?.columns?.length; else emptyProjectBoard">
    <div class="inline-block" cdkDropListGroup>
      <div
        *ngFor="let column of activeBoard?.columns; let i = index"
        class="mr-6 inline-block w-[28rem] whitespace-normal"
      >
        <div class="flex flex-col">
          <!-- Column Title -->
          <h3
            class="mb-3 flex items-center text-sm font-bold uppercase tracking-wide text-grey-medium"
          >
            <span
              [ngStyle]="{ background: colors[i % colors.length] }"
              class="mr-2 h-6 w-6 rounded-full"
            ></span>
            <span>{{ column?.name }} ({{ column?.tasks?.length || 0 }})</span>
          </h3>

          <!-- Tasks -->
          <ng-container *ngIf="column.tasks">
            <div
              cdkDropList
              [cdkDropListData]="column.tasks"
              (cdkDropListDropped)="drop($event)"
              class="flex min-h-[500px] flex-col gap-4"
              [ngClass]="{
                'rounded-md outline-dashed outline-2 outline-purple-medium':
                  column?.tasks?.length === 0
              }"
            >
              <ng-container
                *ngFor="
                  let task of getPagedTasks(getFilteredTasks(column.tasks), i)
                "
              >
                <app-task-card
                  cdkDrag
                  [cdkDragData]="task"
                  (click)="viewTask(task)"
                  (keyup.enter)="viewTask(task)"
                  [task]="task"
                >
                  <div class="drag-handle" cdkDragHandle>
                    <svg width="24px" fill="#828fa3" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                  </div>
                </app-task-card>
              </ng-container>
            </div>
          </ng-container>

          <!-- ðŸ“„ Pagination Controls -->
          <div
            *ngIf="getFilteredTasks(column.tasks).length > itemsPerPage"
            class="flex justify-between items-center mt-3 px-2"
          >
            <button
              class="px-4 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-sm hover:bg-purple-500 hover:text-white transition"
              (click)="prevPage(i)"
              [disabled]="pages[i] === 1"
            >
              Prev
            </button>
            <span class="text-xs text-gray-500"
              >Page {{ pages[i] || 1 }}</span
            >
            <button
              class="px-4 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-sm hover:bg-purple-500 hover:text-white transition"
              (click)="nextPage(getFilteredTasks(column.tasks).length, i)"
              [disabled]="
                pages[i] * itemsPerPage >= getFilteredTasks(column.tasks).length
              "
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<!-- ðŸ›‘ Empty Board Fallback -->
<ng-template #emptyProjectBoard>
  <div class="flex h-full flex-col items-center justify-center">
    <h3 class="mb-4 text-center text-lg font-bold text-grey-medium">
      This board is empty. Create a new column to get started.
    </h3>
    <button (click)="addColumn()" class="w-60 sm:w-75 lg:w-64 py-5 rounded-xl font-semibold text-lg text-white bg-indigo-600 hover:bg-indigo-700 transition-shadow shadow-md"
      style="background-color: rgba(99, 95, 199, 1.0);">
      + Add New Board
    </button>
  </div>
</ng-template>
